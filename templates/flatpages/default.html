<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="stylesheet" href="/static/styles.css">
        <link rel="stylesheet" href="/static/main__style.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="/static/styleconnection.css">
        <link rel="stylesheet" href="/static/personalAccountProfile.css">
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Gothic+A1:wght@400;500;700;800;900&display=swap" rel="stylesheet">
        {% load static %}
        <link href="{% static 'styles.css' %}" rel="stylesheet" />
        <link rel="website icon" type="png" href="/static/istok_icon.png">

        <title>{% block title %}{% endblock title %}</title>
        <style>
        @import url('https://fonts.googleapis.com/css2?family=Gothic+A1&display=swap');

        /* Стили для модального окна */
        .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
}

.modal-content {
    background-color: #fefefe;
    margin: 0 auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    position: relative;
    border-radius: 16px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
    </style>

        <!--Чат поддержки-->
        <script src="//code.jivo.ru/widget/DpEUU3XOG1" async></script>

    </head>
    <body style="height: 100vh; width: 100vw;">
        <div class="wrapper">
            <header class="header">
                <div class="header__wrap">
                    <a href="{% url 'home' %}">
                        <span class="header__logo" style="margin-left: -12em;">
                        <svg width="216" height="56" viewBox="0 0 216 56" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_498_21)">
                            <path d="M57.5533 7.66684C55.7099 10.0412 53.8966 12.3733 51.9383 14.8927C51.3278 14.3429 50.7959 13.8474 50.2459 13.3762C46.565 10.2527 42.461 8.40393 37.4927 9.26184C34.0476 9.85996 32.198 11.9383 32.3129 15.0316C32.3854 16.8804 33.2014 18.4089 34.7668 19.2849C36.9004 20.4812 39.173 21.4478 41.3973 22.4749C44.8968 24.0941 48.5959 25.3749 51.8839 27.3505C58.0369 31.0541 59.3485 37.0534 58.333 43.6267C57.3237 50.1456 52.8268 53.5652 46.7524 55.0394C38.1515 57.1237 30.4271 54.8883 23.4038 49.8073C21.7477 48.6111 20.2064 47.2457 18.502 45.8682C20.5328 43.2098 22.4428 40.7146 24.8121 37.6213C25.1747 38.298 25.3319 38.884 25.7066 39.2526C30.7535 44.2188 36.7614 47.1671 43.6699 45.7232C47.5865 44.9015 49.1701 38.7934 46.4321 36.0203C45.6886 35.2651 44.6369 34.7274 43.6336 34.3105C39.9164 32.788 36.0603 31.5555 32.4459 29.8216C29.998 28.6434 27.5803 27.0847 25.6583 25.1876C19.0278 18.6506 20.4663 7.86622 28.4627 3.09332C39.0763 -3.24436 52.2707 1.44999 57.5594 7.6608L57.5533 7.66684Z" fill="#341D10"/>
                            <path d="M63.4343 0H103.979L104.051 10.8025L89.4605 10.9112C89.4605 10.9112 89.4121 55.0333 89.4121 55.6737H78.4238C78.4238 55.0212 78.4299 11.0622 78.4299 11.0622L63.3799 10.9112L63.4343 0Z" fill="#341D10"/>
                            <path d="M11.1099 0.066452L11.0978 55.7825C11.0978 55.7825 3.12557 55.7825 0.0128208 55.7825C0.0128208 55.0938 0.000732422 8.40996 0.000732422 8.40996L11.1099 0.066452Z" fill="#341D10"/>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M171.081 55.9823L182.667 56.0004L182.674 56.0064C182.674 56.0064 182.522 46.3639 182.438 41.8085C182.414 40.4008 182.831 39.3556 183.725 38.2923C184.153 37.7838 184.603 37.2494 185.072 36.6922L202.185 55.662C202.185 55.662 214.176 55.65 215.409 55.65C212.136 51.5914 195.584 34.5446 190.912 29.7474C201.705 16.9047 215.814 0.0849609 215.814 0.0849609L201.459 0.260169C201.459 0.260169 182.939 23.1036 182.468 23.6776L182.42 0.169544L171.057 0.133294L171.081 55.9823Z" fill="#341D10"/>
                            <g clip-path="url(#clip1_498_21)">
                            <path d="M163.124 0.230444C163.124 11.9413 164.712 23.4681 162.768 34.3574C159.483 52.69 138.15 61.1757 121.911 51.9174C120.853 51.3166 119.819 50.6789 118.528 49.9064C118.528 49.9064 116.368 48.0818 113.843 44.8204C111.67 41.687 110.137 38.0239 110.137 38.0239C102.633 20.5864 115.415 0.966202 134.423 0.291757C144.031 -0.0515964 153.664 0.230444 163.124 0.230444ZM125.956 44.8204C135.109 52.1167 144.998 48.8874 151.075 40.5144C144.097 38.8488 141.383 38.4575 134.014 39.1189C131.088 39.8392 128.432 42.0295 125.956 44.8204ZM123.705 11.344C114.837 18.6366 114.657 28.8553 119.428 36.9131C120.708 35.1596 127.711 28.4051 128.612 25.7041L123.705 11.344ZM128.612 25.7041C129.197 23.9485 127.49 14.4951 123.705 11.344L128.612 25.7041ZM149.364 7.23587C145.448 6.84904 139.592 7.1993 139.063 7.23587C139.063 7.23587 138.155 7.23587 137.3 7.51764C135.679 8.26279 137.708 17.2028 138.65 17.4662C138.65 17.4662 149.004 8.10949 149.364 7.23587ZM156.342 13.8199C152.552 17.1308 140.721 28.7202 140.721 28.7202C140.721 28.7202 140.406 29.1254 140.994 29.358C140.994 29.358 150.624 31.9163 154.631 28.7202C156.393 24.2256 156.342 13.8199 156.342 13.8199Z" fill="#548216"/>
                            </g>
                            </g>
                            <defs>
                            <clipPath id="clip0_498_21">
                            <rect width="215.807" height="56" fill="white"/>
                            </clipPath>
                            <clipPath id="clip1_498_21">
                            <rect width="56.3213" height="55.6356" fill="white" transform="translate(107.418 0.060791)"/>
                            </clipPath>
                            </defs>
                        </svg>
                    </span>
                    </a>
                    <nav class="header__nav" style="margin-right: -15em;">
                        <ul class="header__list">
                            <li class="header__item">
                                <a class="header__link" href="{% url 'index' %}">Каталог</a>
                            </li>
                            <li class="header__item">
                                <a id="consultationBtn" class="header__link">Записаться на консультацию</a>
                            </li>
                            <li class="header__item">
                                <a class="header__link" href="{% url 'about_us' %}">О нас</a>
                            </li>
                            {% if user.is_authenticated %}
                            <li class="header__item">
                                <a class="header__link" href="{% url 'profile' %}">Профиль</a>
                            </li>
                            {% else %}
                            <li class="header__item">
                                <a id="loginBtn" class="header__link" href="#">Регистрация/вход</a>
                            </li>
{% endif %}
                        </ul>
                    </nav>
                </div>
            </header>

            {% block content %}{% endblock content %}

            <footer class="footer">
                <div class="footer__wrap">
                    <div class="footer__info_wrap">
                        <ul class="footer__info">
                            <li class="footer__item">
                                <svg width="336" height="88" viewBox="0 0 216 56" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_498_21)">
                                    <path d="M57.5533 7.66684C55.7099 10.0412 53.8966 12.3733 51.9383 14.8927C51.3278 14.3429 50.7959 13.8474 50.2459 13.3762C46.565 10.2527 42.461 8.40393 37.4927 9.26184C34.0476 9.85996 32.198 11.9383 32.3129 15.0316C32.3854 16.8804 33.2014 18.4089 34.7668 19.2849C36.9004 20.4812 39.173 21.4478 41.3973 22.4749C44.8968 24.0941 48.5959 25.3749 51.8839 27.3505C58.0369 31.0541 59.3485 37.0534 58.333 43.6267C57.3237 50.1456 52.8268 53.5652 46.7524 55.0394C38.1515 57.1237 30.4271 54.8883 23.4038 49.8073C21.7477 48.6111 20.2064 47.2457 18.502 45.8682C20.5328 43.2098 22.4428 40.7146 24.8121 37.6213C25.1747 38.298 25.3319 38.884 25.7066 39.2526C30.7535 44.2188 36.7614 47.1671 43.6699 45.7232C47.5865 44.9015 49.1701 38.7934 46.4321 36.0203C45.6886 35.2651 44.6369 34.7274 43.6336 34.3105C39.9164 32.788 36.0603 31.5555 32.4459 29.8216C29.998 28.6434 27.5803 27.0847 25.6583 25.1876C19.0278 18.6506 20.4663 7.86622 28.4627 3.09332C39.0763 -3.24436 52.2707 1.44999 57.5594 7.6608L57.5533 7.66684Z" fill="#341D10"/>
                                    <path d="M63.4343 0H103.979L104.051 10.8025L89.4605 10.9112C89.4605 10.9112 89.4121 55.0333 89.4121 55.6737H78.4238C78.4238 55.0212 78.4299 11.0622 78.4299 11.0622L63.3799 10.9112L63.4343 0Z" fill="#341D10"/>
                                    <path d="M11.1099 0.066452L11.0978 55.7825C11.0978 55.7825 3.12557 55.7825 0.0128208 55.7825C0.0128208 55.0938 0.000732422 8.40996 0.000732422 8.40996L11.1099 0.066452Z" fill="#341D10"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M171.081 55.9823L182.667 56.0004L182.674 56.0064C182.674 56.0064 182.522 46.3639 182.438 41.8085C182.414 40.4008 182.831 39.3556 183.725 38.2923C184.153 37.7838 184.603 37.2494 185.072 36.6922L202.185 55.662C202.185 55.662 214.176 55.65 215.409 55.65C212.136 51.5914 195.584 34.5446 190.912 29.7474C201.705 16.9047 215.814 0.0849609 215.814 0.0849609L201.459 0.260169C201.459 0.260169 182.939 23.1036 182.468 23.6776L182.42 0.169544L171.057 0.133294L171.081 55.9823Z" fill="#341D10"/>
                                    <g clip-path="url(#clip1_498_21)">
                                    <path d="M163.124 0.230444C163.124 11.9413 164.712 23.4681 162.768 34.3574C159.483 52.69 138.15 61.1757 121.911 51.9174C120.853 51.3166 119.819 50.6789 118.528 49.9064C118.528 49.9064 116.368 48.0818 113.843 44.8204C111.67 41.687 110.137 38.0239 110.137 38.0239C102.633 20.5864 115.415 0.966202 134.423 0.291757C144.031 -0.0515964 153.664 0.230444 163.124 0.230444ZM125.956 44.8204C135.109 52.1167 144.998 48.8874 151.075 40.5144C144.097 38.8488 141.383 38.4575 134.014 39.1189C131.088 39.8392 128.432 42.0295 125.956 44.8204ZM123.705 11.344C114.837 18.6366 114.657 28.8553 119.428 36.9131C120.708 35.1596 127.711 28.4051 128.612 25.7041L123.705 11.344ZM128.612 25.7041C129.197 23.9485 127.49 14.4951 123.705 11.344L128.612 25.7041ZM149.364 7.23587C145.448 6.84904 139.592 7.1993 139.063 7.23587C139.063 7.23587 138.155 7.23587 137.3 7.51764C135.679 8.26279 137.708 17.2028 138.65 17.4662C138.65 17.4662 149.004 8.10949 149.364 7.23587ZM156.342 13.8199C152.552 17.1308 140.721 28.7202 140.721 28.7202C140.721 28.7202 140.406 29.1254 140.994 29.358C140.994 29.358 150.624 31.9163 154.631 28.7202C156.393 24.2256 156.342 13.8199 156.342 13.8199Z" fill="#548216"/>
                                    </g>
                                    </g>
                                    <defs>
                                    <clipPath id="clip0_498_21">
                                    <rect width="215.807" height="56" fill="white"/>
                                    </clipPath>
                                    <clipPath id="clip1_498_21">
                                    <rect width="56.3213" height="55.6356" fill="white" transform="translate(107.418 0.060791)"/>
                                    </clipPath>
                                    </defs>
                                </svg>
                            </li>
                            <li class="footer__item">
                               <a id="consultationBtnFooter" class="footer__link">Записаться на консультацию</a>
                            </li>
                            <li class="footer__item">
                                <a class="footer__link" href="{% url 'about_us' %}">О нас</a>
                            </li>
                        </ul>
                        <h3 class="footer__title">Скачать приложение</h3>
                        <div class="footer__app_icon">
                            <img src="/static/images/svg/appStore.svg" class="icon_img" alt="icons" width="256" height="88">
                            <img src="/static/images/svg/googlePlay.svg" class="icon_img" alt="icons" width="256" height="88">
                        </div>
                    </div>
                    <ul class="footer__catalog">
                        <li class="footer__item">
                            <a class="footer__link footer__title" href="{% url 'index' %}">Каталог</a>
                        </li>
                        <li class="footer__item">
                            <a class="footer__link" href="{% url 'product_detail' pk=2 %}">Кухня</a>
                        </li>
                        <li class="footer__item">
                            <a class="footer__link" href="{% url 'product_detail' pk=8 %}">Гардеробы</a>
                        </li>
                        <li class="footer__item">
                            <a class="footer__link" href="{% url 'product_detail' pk=5 %}">Стеллажи</a>
                        </li>
                        <li class="footer__item">
                            <a class="footer__link" href="{% url 'product_detail' pk=15 %}">Ванные комнаты</a>
                        </li>
                        <li class="footer__item">
                            <a class="footer__link" href="{% url 'product_detail' pk=12 %}">Комоды</a>
                        </li>
                        <li class="footer__item">
                            <a class="footer__link" href="{% url 'product_detail' pk=19 %}">Мебель в детскую</a>
                        </li>
                        <li class="footer__item">
                            <a class="footer__link" >Комплексная меблировка</a>
                        </li>
                    </ul>
                    <div class="footer__contacts">
                        <h3 class="footer__title">Связаться с нами</h3>
                        <div class="footer__contacts_icon">
                            <a href="https://wa.me/79311213900" target="_blank" rel="noopener noreferrer">
                                <img src="/static/images/svg/whatsApp.svg" class="icon_img" alt="WhatsApp" width="72" height="72">
                            </a>
                            <a href="tel:+78129662997" target="_blank" rel="noopener noreferrer">
                                <img src="/static/images/svg/viber.svg" class="icon_img" alt="Viber" width="72" height="72">
                            </a>
                            <a href="https://vk.com/istokmebel" target="_blank" rel="noopener noreferrer">
                                <img src="/static/images/svg/vk.svg" class="icon_img" alt="VK" width="72" height="72">
                            </a>
                            <a href="https://t.me/ISTOK_Connect" target="_blank" rel="noopener noreferrer">
                                <img src="/static/images/svg/telegram.svg" class="icon_img" alt="Telegram" width="72" height="72">
                            </a>
                        </div>
                        <p class="footer__contacts_company"><span class="footer__contacts_company_span">8 (800) 222 00-62</span> <br>
                            Звонок бесплатный 24/7</p>
                        <p class="footer__contacts_company">ООО “Исток-Мебель” 2024 <br><span class="footer__contacts_company_underlining" data-url="https://istok-mebel.ru/policy">Политика Конфиденциальности</span> </p>
                    </div>
                </div>
            </footer>
        </div>
        <!-- Модальное окно -->
    <div id="loginModal" class="modal">
        <div class="modal-content" id="modal1">
            <span class="close">&times;</span>
            <article class="loginRegistration">
                <h1 class="loginRegistration__title">Вход / Регистрация</h1>
                <form class="loginRegistration__numPhone">
                    <label class="loginRegistration__head">Номер телефона</label>
                    <input class="loginRegistration__input" type="text" placeholder="+7 (999)999-99-99">
                </form>
                <form class="loginRegistration__code">
                    <input class="loginRegistration__phone" type="text" placeholder="Код">
                    <input class="loginRegistration__take" type="button" value="Получить код">
                </form>
                <span class="loginRegistration__or">ИЛИ</span>
                <div class="loginRegistration__box">
                    <button class="loginRegistration__btn loginRegistration__btn_google"><img src="/static/styleconnection/google.svg">Войти с помощью Google</button>
                    <button class="loginRegistration__btn loginRegistration__btn_yandex"><img src="/static/styleconnection/yandex.svg">Войти с помощью Yandex</button>
                    <button class="loginRegistration__btn loginRegistration__btn_apple"><img src="/static/styleconnection/apple.svg">Войти с помощью Apple ID</button>
                </div>
            </article>
        </div>
        <div class="wrapper" id="modal2">
            <span class="close">&times;</span>
            <article class="connection">
                <p class="footer__item" >
                    <a id="consultationBtnFooter2" class="footer__link">Записаться на консультацию</a>
                </p>
                <p class="connection__text">Закажите выезд нашего специалиста, и мы предоставим Вам уникальную скидку в 10% на заказ от любой суммы. Оформите заявку в числе первых!</p>
                <section class="connection__wrapper">
                    <form class="connection__field">
                        <label class="connection__head">Имя</label>
                        <input class="connection__input" type="text" placeholder="Как к Вам обращаться?">
                    </form>
                    <form class="connection__field">
                        <label class="connection__head">Номер телефона</label>
                        <input class="connection__input" type="text" placeholder="+7 (999)999-99-99">
                    </form>
                </section>
                <section class="connection__wrapper">
                    <form class="connection__dataInput" method="post">
                        <fieldset class="connection__help">
                            <legend class="connection__head connection__help_checkboxRadio">Что вас интересует?</legend>
                            <a href="/2">
                            <label class="connection__label">
                                <input class="" type="checkbox" name="level">
                                Кухня
                            </label>
                            </a>
                            <label class="connection__label">
                                <input class="" type="checkbox" name="level">
                                Гардероб
                            </label>
                            <label class="connection__label">
                                <input class="" type="checkbox" name="level">
                                Прихожая
                            </label>
                            <label class="connection__label">
                                <input class="" type="checkbox" name="level">
                                Гостиная
                            </label>
                            <label class="connection__label">
                                <input class="" type="checkbox" name="level">
                                Полная меблировка
                            </label>
                        </fieldset>
                    </form>
                    <form class="connection__dataInput" method="post">
                        <fieldset class="connection__help">
                            <legend class="connection__head connection__help_checkboxRadio">Как с Вами связаться?</legend>
                            <label class="connection__label">
                                <input class="" type="radio" name="level">
                                Позвонить
                            </label>
                            <label class="connection__label">
                                <input class="" type="radio" name="level">
                                Написать в Telegram
                            </label>
                            <label class="connection__label">
                                <input class="" type="radio" name="level">
                                Написать в WhatsApp
                            </label>
                            <input class="connection__btn" type="button" value="Отправить">
                        </fieldset>
                    </form>
                </section>
            </article>
        </div>
        </div>
        <script src="{% static 'popup.js' %}"></script>
        <script>
    // Получаем элементы
var loginModal = document.getElementById("loginModal");
var loginBtn = document.getElementById("loginBtn");
var consultationBtn = document.getElementById("consultationBtn");
var consultationBtnFooter = document.getElementById("consultationBtnFooter");
var closeBtn = document.getElementsByClassName("close")[0];
var modal1 = document.getElementById("modal1");
var modal2 = document.getElementById("modal2");
var closeBtns = document.getElementsByClassName("close");

// Открываем модальное окно 1 при нажатии на кнопку "Регистрация/вход"
if (loginBtn) {
    loginBtn.onclick = function() {
        loginModal.style.display = "block";
        modal1.style.display = "block";
        modal2.style.display = "none";
    }
}

// Открываем модальное окно 2 при нажатии на кнопку "Записаться на консультацию"
consultationBtn.onclick = function() {
    loginModal.style.display = "block";
    modal1.style.display = "none";
    modal2.style.display = "block";
}
// Обработчик для кнопки в футере
consultationBtnFooter.onclick = function() {
    loginModal.style.display = "block";
    modal1.style.display = "none";
    modal2.style.display = "block";
}
// Обработчик для кнопки в футере
consultationBtnFooter2.onclick = function() {
    loginModal.style.display = "block";
    modal1.style.display = "none";
    modal2.style.display = "block";
}

// Закрываем модальное окно при нажатии вне его
window.onclick = function(event) {
    if (event.target == loginModal) {
        loginModal.style.display = "none";
    }
}
// Генерация случайного 5-значного кода
function generateCode() {
  return Math.floor(10000 + Math.random() * 90000);
}

// Обработчик нажатия кнопки "Получить код"
document.querySelector('.loginRegistration__take').addEventListener('click', function() {
  const code = generateCode();
  console.log("Сгенерированный код:", code);
  window.generatedCode = code;
});

document.querySelector('.loginRegistration__phone').addEventListener('input', function() {
  const enteredCode = this.value;
  console.log("Введенный код:", enteredCode);

  if(enteredCode.length === 5) {
    if(parseInt(enteredCode) === window.generatedCode) {
      console.log("Код верный");

      // Получаем номер телефона
      const phoneNumber = document.querySelector('.loginRegistration__input').value;
      console.log("Номер телефона:", phoneNumber);

      // Создаем или авторизуем пользователя
      createOrLoginUser(phoneNumber);
    } else {
      console.log("Неверный код");
    }
  }
});
function createOrLoginUser(phoneNumber) {
  console.log("Функция createOrLoginUser вызвана с номером:", phoneNumber);

  const code = window.generatedCode;
  if (!code) {
    console.error("Ошибка: Код не был сгенерирован");
    return;
  }

  console.log("Отправка запроса на сервер...");

  fetch('{% url 'create_or_login_user' %}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({
      phone_number: phoneNumber,
      code: code
    })
  })
  .then(response => {
    console.log("Получен ответ от сервера", response.status);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    if (data.success) {
      console.log('Пользователь успешно создан/авторизован');
      // Перенаправление или обновление UI
      window.location.reload();
    } else {
      console.error('Ошибка:', data.error);
      // Показать сообщение об ошибке пользователю
    }
  })
  .catch(error => {
    console.error('Ошибка при отправке запроса:', error);
    // Показать сообщение об ошибке пользователю
  });
}

// Обработчик для каждой кнопки закрытия
for (var i = 0; i < closeBtns.length; i++) {
    closeBtns[i].onclick = function() {
        loginModal.style.display = "none";
    }
}
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
};
document.addEventListener('DOMContentLoaded', function() {
    var catalogOpen = document.querySelector('.footer__contacts_company_underlining');

    catalogOpen.addEventListener('click', function() {
      var url = this.getAttribute('data-url');
      window.location.href = url;
    });
  });


function saveAppointment(formData) {
    console.log("Функция saveAppointment вызвана с данными:", formData);

    console.log("Отправка запроса на сервер...");

    fetch('{% url 'save_appointment' %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        console.log("Получен ответ от сервера", response.status);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.status === 'success') {
            console.log('Заявка успешно отправлена');
        } else {
            console.error('Ошибка:', data.error);
        }
    })
    .catch(error => {
        console.error('Ошибка при отправке запроса:', error);
    });
}

document.querySelector('.connection__btn').addEventListener('click', function() {
    let formData = {
        name: document.querySelector('input[placeholder="Как к Вам обращаться?"]').value,
        phone_number: document.querySelector('input[placeholder="+7 (999)999-99-99"]').value,
        purpose: getSelectedPurpose(),
        notes: "Заявка с сайта",
        contact_method: getSelectedContactMethod()
    };

    saveAppointment(formData);
});

function getSelectedPurpose() {
    const checkboxes = document.querySelectorAll('.connection__help input[type="checkbox"]:checked');
    if (checkboxes.length > 1) {
        return 'complex_order';
    } else if (checkboxes.length === 1) {
        return checkboxes[0].value;
    }
    return '';
}

function getSelectedContactMethod() {
    const radio = document.querySelector('.connection__help input[type="radio"]:checked');
    return radio ? radio.value : '';
}
    </script>
    </body>
</html>