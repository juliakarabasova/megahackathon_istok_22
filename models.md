### Описание моделей баз данных для каждой функциональной области

#### 1. Пользователи (Users)

**CustomUser**
- **ID**: Уникальный идентификатор пользователя.
- **Имя пользователя**: Логин пользователя (уникальный).
- **Пароль**: Хэшированный пароль.
- **Электронная почта**: Электронная почта пользователя (уникальная).
- **Имя**: Имя пользователя.
- **Фамилия**: Фамилия пользователя. (Далее можно предложить заполнять форму по желанию, с процентами заполнения)
- **Номер телефона**: Телефон пользователя.
- **Дети**: Есть ли дети (да/нет).
- **Планирование ремонта**: Планируется ли ремонт (да/нет).
- **Дата ремонта**: Когда начинают ремонт (уже идет/скоро приступаем/в течение полугода/в течение года).
- **Место ремонта**: В каких комнатах ремонт (множ: кухня/коридор/прихож/ванная/детская/спальня/гостин/столов/кабинет) - (многие ко многим или список).
- **Рассылка**: Согласие на рассылку (да/нет) ((при регистрации))
- **Согласие на обработку**: Согласие на обработку персональных данных ((при регистрации, должно быть ДА всегда).
- **Дата регистрации**: Дата создания аккаунта.
- **Бонусные очки**: Количество бонусных очков пользователя ((референс/айди к строке программы лояльности)).
- **Реферальный код**: Уникальный реферальный код для приглашений ((референс к строке реферальной программы)).

#### 2. Программа лояльности (Loyalty)

Либо в лояльность, либо при оформлении заказа нужно реализовать выбор акции из определенного пула.

**Loyalty**
- **ID**: Уникальный идентификатор записи.
- **Пользователь**: Ссылка на пользователя, связанного с программой лояльности.
- **Количество очков**: Количество бонусных очков пользователя -- метод изменения (зачисление, списание).

**LoyaltyTransaction**
- **ID**: Уникальный идентификатор транзакции.
- **Пользователь**: Ссылка на пользователя, связанного с транзакцией.
- **Количество очков**: Количество бонусных очков, участвующих в транзакции.
- **Тип транзакции**: Тип транзакции (начисление или списание).
- **Дата**: Дата и время выполнения транзакции.

#### 2.2. Реферальная программа (Referal)

**Referal**
- **ID**: Уникальный идентификатор записи. (Использованный реферальный код, например)
- **Пользователь**: Пользователь компании (ссылка), кто рекомендовал
- **Новый пользователь**: Ссылка на пользователя, который пришел по реферальному коду
- **Акция**: Какую акцию (подарок) пользователь выбрал за использование программы
- **Подтверждение**: bool: Да, если новый пользователь оформил заказ.

#### 3. Заказы (Orders)

**Order**
- **ID**: Уникальный идентификатор заказа (номер договора).
- **Пользователь**: Ссылка на пользователя, сделавшего заказ.
- **Продукт**: Ссылка на продукт, который был заказан.
- **Статус**: Текущий статус заказа (Подготовка эскиза, Ожидание технического замера, Корректировка после технический замера, Обработка конструктором, Производство, Подготовка к доставке, Доставка, Доставлен).
- **Дедлайн исполнения заказа**
- **Стоимость**: Стоимость заказа (нужно ли отдельно учесть - полная, скидка, доставка (доставка бесплатна в пределах КАД)).
- **Договор (PDF)**: Ссылка на PDF-файл договора.
- **Спецификация (PDF)**: Ссылка на PDF-файл спецификации.
- **Чек (PDF)**: Ссылка на PDF-чек.
- **3D Модель**: Ссылка на 3D модель продукта.
- **Дата заказа**: Дата создания заказа (заключения договора).
- **Дата завершения**: Дата завершения работ по заказу.
- **Дата доставки**: Дата доставки заказа.
- **Адрес доставки**: Адрес места доставки.
- **Дата установки**: Фактическая дата установки заказа.

**OrderTimeline**
- **ID**: Уникальный идентификатор записи временной шкалы.
- **Заказ**: Ссылка на связанный заказ.
- **Дата**: Дата события (например, смена статуса).
- **Событие**: Описание события, произошедшего с заказом.

#### 4. Каталог мебели (Products)

Возможно будет также каталог услуг, пока изучаю.

**Product**
- **ID**: Уникальный идентификатор продукта.
- **Название**: Название продукта.
- **Описание**: Подробное описание продукта.
- **Цена**: Цена продукта.
- **Цветное изображение**: Ссылка на цветное изображение продукта.
- **Черно-белый эскиз**: Ссылка на черно-белый эскиз продукта.
- **3D Модель**: Ссылка на 3D модель продукта.
- **Категория**: Категория, к которой относится продукт - кухня, гардероб, прихожая, комод, стеллаж (для фильтрации).
- **Назначение**: Домой, в офис, детская (для фильтрации).
- **Форма**: Форма изделия (для фильтрации)
- **Материал фасадов** (для фильтрации)
- **Материал столешницы** (для фильтрации)

#### 5. Запись на встречи (Appointments)

**Appointment**
- **ID**: Уникальный идентификатор записи на встречу.
- **Пользователь**: Ссылка на пользователя, записавшегося на встречу.
- **Способ связи**: Телефон или соц сети.
- **Для связи**: Ссылка на соц сеть, если выбран этот способ, иначе номер телефона - из юзера, елсли указан уже, из формы если нет.
- **Дата и время**: Дата и время назначенной встречи.
- **Подтверждение**: Нужно ли подтверждение менеджера (да/нет).
- **Цель**: Какая мебель потребуется? Кухня, шкаф, прихожая, гардероб, мебель для ванной, мебель для детской, мебель для гостиной, комплексный заказ (Выбор одного).
- **Консультация**: Потребуется ли предварительная консультация с экспертом по обустройству дома? (да/нет)
- **Заметки**: Дополнительные заметки, связанные с встречей.

#### 6. Чат поддержки (Chat)

Бот поддержки: приветствие, цель обращения (кнопки: хочу сдл заказ, консульт эксперта, обращ по текущ заказ, сервис подд), соедин со специалистом.

**ChatMessage**
- **ID**: Уникальный идентификатор сообщения.
- **Пользователь**: Ссылка на пользователя, отправившего сообщение.
- **Сообщение**: Текст сообщения.
- **Временная метка**: Дата и время отправки сообщения.

#### 7. Акции и новости (Promotions)

**Promotion**
- **ID**: Уникальный идентификатор акции.
- **Название**: Название акции.
- **Описание**: Подробное описание акции.
- **Дата начала**: Дата начала акции.
- **Дата окончания**: Дата окончания акции.
- **Активность**: Флаг активности акции.
- **Программа**: Общая акция (для всех)/По лояльности/Реферальная. (Пока я вижу, что так будет удобно, на практике увидим).

**News** (Скорее всего не потребуется, можно сейчас не делать)
- **ID**: Уникальный идентификатор новости.
- **Название**: Название новости.
- **Содержание**: Подробное содержание новости.
- **Дата публикации**: Дата и время публикации новости.

### Графическое представление

Графически схема базы данных могла бы выглядеть следующим образом:

```
+------------------+        +------------------+
| CustomUser       |        | Product          |
|------------------|        |------------------|
| id               |<-------| id               |
| username         |        | name             |
| password         |        | description      |
| email            |        | price            |
| first_name       |        | color_image      |
| last_name        |        | bw_image         |
| loyalty_points   |        | model_3d         |
| referral_code    |        | category         |
+------------------+        +------------------+
        |                            ^
        |                            |
        v                            |
+------------------+        +------------------+
| LoyaltyTransaction |      | Order            |
|------------------|        |------------------|
| id               |        | id               |
| user_id          |--------| user_id          |
| points           |        | product_id       |
| transaction_type |        | status           |
| date             |        | contract_pdf     |
+------------------+        | specification_pdf|
                            | model_3d         |
                            | order_date       |
                            | completion_date  |
                            | delivery_date    |
                            | installation_date|
                            +------------------+
                                    |
                                    v
                            +------------------+
                            | OrderTimeline    |
                            |------------------|
                            | id               |
                            | order_id         |
                            | date             |
                            | event            |
                            +------------------+

+------------------+        +------------------+
| Appointment      |        | ChatMessage      |
|------------------|        |------------------|
| id               |        | id               |
| user_id          |--------| user_id          |
| date_time        |        | message          |
| notes            |        | timestamp        |
+------------------+        +------------------+

+------------------+        +------------------+
| Promotion        |        | News             |
|------------------|        |------------------|
| id               |        | id               |
| title            |        | title            |
| description      |        | content          |
| start_date       |        | published_date   |
| end_date         |        +------------------+
| active           |
+------------------+
```

### Объяснение

Эти модели описывают основные сущности, которые будут использоваться в системе ISTOK для управления пользователями, программой лояльности, заказами, каталогом мебели, записями на встречи, поддержкой через чат, а также акциями и новостями. Каждая модель содержит атрибуты, необходимые для хранения и обработки соответствующих данных.

---

### Описание моделей баз данных для каждой функциональной области

#### 1. Пользователи (Users)

**models.py** (в приложении `users`):
```python
from django.contrib.auth.models import AbstractUser
from django.db import models

class CustomUser(AbstractUser):
    """
    Модель пользователя с дополнительными полями для бонусных очков и реферального кода.
    """
    loyalty_points = models.IntegerField(default=0)
    referral_code = models.CharField(max_length=100, unique=True, blank=True, null=True)
```
- **CustomUser**: Расширенная модель пользователя с дополнительными полями:
  - `loyalty_points`: Бонусные очки пользователя.
  - `referral_code`: Уникальный реферальный код.

#### 2. Программа лояльности (Loyalty)

**models.py** (в приложении `loyalty`):
```python
from django.db import models
from users.models import CustomUser

class LoyaltyTransaction(models.Model):
    """
    Модель транзакций программы лояльности, хранит данные о начислении и списании бонусов.
    """
    user = models.ForeignKey(CustomUser, on_delete=models.CASCADE)
    points = models.IntegerField()
    transaction_type = models.CharField(max_length=10, choices=[('earn', 'Earn'), ('redeem', 'Redeem')])
    date = models.DateTimeField(auto_now_add=True)
```
- **LoyaltyTransaction**: Модель для хранения транзакций лояльности:
  - `user`: Связь с пользователем.
  - `points`: Количество бонусных очков.
  - `transaction_type`: Тип транзакции (начисление или списание).
  - `date`: Дата транзакции.

#### 3. Заказы (Orders)

**models.py** (в приложении `orders`):
```python
from django.db import models
from users.models import CustomUser
from products.models import Product

class Order(models.Model):
    """
    Модель заказа, содержит информацию о заказе, статусе и связанных документах.
    """
    user = models.ForeignKey(CustomUser, on_delete=models.CASCADE)
    product = models.ForeignKey(Product, on_delete=models.CASCADE)
    status = models.CharField(max_length=20, choices=[
        ('created', 'Created'),
        ('processing', 'Processing'),
        ('shipped', 'Shipped'),
        ('delivered', 'Delivered'),
        ('installed', 'Installed')
    ])
    contract_pdf = models.FileField(upload_to='contracts/')
    specification_pdf = models.FileField(upload_to='specifications/')
    model_3d = models.FileField(upload_to='3d_models/')
    order_date = models.DateField()
    completion_date = models.DateField()
    delivery_date = models.DateField()
    installation_date = models.DateField()

class OrderTimeline(models.Model):
    """
    Модель временной шкалы заказа, содержит ключевые события заказа.
    """
    order = models.ForeignKey(Order, on_delete=models.CASCADE)
    date = models.DateField()
    event = models.CharField(max_length=100)
```
- **Order**: Модель для хранения данных о заказе:
  - `user`: Связь с пользователем.
  - `product`: Связь с продуктом.
  - `status`: Статус заказа.
  - `contract_pdf`: Договор в формате PDF.
  - `specification_pdf`: Спецификация в формате PDF.
  - `model_3d`: 3D модель заказа.
  - `order_date`: Дата заказа.
  - `completion_date`: Дата завершения работ.
  - `delivery_date`: Дата доставки.
  - `installation_date`: Дата монтажа.

- **OrderTimeline**: Модель для хранения временной шкалы заказа:
  - `order`: Связь с заказом.
  - `date`: Дата события.
  - `event`: Описание события.

#### 4. Каталог мебели (Products)

**models.py** (в приложении `products`):
```python
from django.db import models

class Product(models.Model):
    """
    Модель продукта, содержит информацию о мебели, включая изображения и 3D модель.
    """
    name = models.CharField(max_length=100)
    description = models.TextField()
    price = models.DecimalField(max_digits=10, decimal_places=2)
    color_image = models.ImageField(upload_to='product_images/color/')
    bw_image = models.ImageField(upload_to='product_images/bw/')
    model_3d = models.FileField(upload_to='product_models/')
    category = models.CharField(max_length=50)
```
- **Product**: Модель для хранения данных о продукте:
  - `name`: Название продукта.
  - `description`: Описание продукта.
  - `price`: Цена продукта.
  - `color_image`: Цветное изображение продукта.
  - `bw_image`: Черно-белый эскиз продукта.
  - `model_3d`: 3D модель продукта.
  - `category`: Категория продукта.

#### 5. Запись на встречи (Appointments)

**models.py** (в приложении `appointments`):
```python
from django.db import models
from users.models import CustomUser

class Appointment(models.Model):
    """
    Модель встречи, содержит информацию о записи на встречу.
    """
    user = models.ForeignKey(CustomUser, on_delete=models.CASCADE)
    date_time = models.DateTimeField()
    notes = models.TextField(blank=True)
```
- **Appointment**: Модель для хранения данных о встрече:
  - `user`: Связь с пользователем.
  - `date_time`: Дата и время встречи.
  - `notes`: Заметки о встрече.

#### 6. Чат поддержки (Chat)

**models.py** (в приложении `chat`):
```python
from django.db import models
from users.models import CustomUser

class ChatMessage(models.Model):
    """
    Модель сообщения в чате, содержит информацию о сообщениях поддержки.
    """
    user = models.ForeignKey(CustomUser, on_delete=models.CASCADE)
    message = models.TextField()
    timestamp = models.DateTimeField(auto_now_add=True)
```
- **ChatMessage**: Модель для хранения данных о сообщениях в чате:
  - `user`: Связь с пользователем.
  - `message`: Текст сообщения.
  - `timestamp`: Временная метка сообщения.

#### 7. Акции и новости (Promotions)

**models.py** (в приложении `promotions`):
```python
from django.db import models

class Promotion(models.Model):
    """
    Модель акции, содержит информацию о текущих акциях и скидках.
    """
    title = models.CharField(max_length=100)
    description = models.TextField()
    start_date = models.DateField()
    end_date = models.DateField()
    active = models.BooleanField(default=True)

class News(models.Model):
    """
    Модель новости, содержит информацию о новостях компании.
    """
    title = models.CharField(max_length=100)
    content = models.TextField()
    published_date = models.DateTimeField(auto_now_add=True)
```
- **Promotion**: Модель для хранения данных об акциях:
  - `title`: Заголовок акции.
  - `description`: Описание акции.
  - `start_date`: Дата начала акции.
  - `end_date`: Дата окончания акции.
  - `active`: Флаг активности акции.

- **News**: Модель для хранения данных о новостях:
  - `title`: Заголовок новости.
  - `content`: Содержание новости.
  - `published_date`: Дата публикации новости.

### Следующие шаги

1. **Создание миграций**: 
   - Выполнение команд для создания и применения миграций.
   ```sh
   python manage.py makemigrations
   python manage.py migrate
   ```

2. **Настройка администратора**:
   - Создание суперпользователя.
   ```sh
   python manage.py createsuperuser
   ```

3. **Тестирование**: 
   - Написание тестов для всех моделей.
